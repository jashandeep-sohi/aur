# Maintainer: Jashandeep Sohi <jashandeep.s.sohi@gmail.com>
pkgname=('cython3-git' 'cython2-git')
pkgbase="cython-git"
pkgver=20130323
pkgrel=1
pkgdesc="C-Extensions for Python."
arch=('i686' 'x86_64')
url="http://www.cython.org"
license=('APACHE')
_gitroot="https://github.com/cython/cython.git"
_gitname="cython"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"
}

package_cython3-git() {
  depends=('python')
  provides=('cython')
  conflicts=('cython')
  
  cd "$srcdir/$_gitname-build"
  python3 setup.py install --root="$pkgdir/" --optimize=1
  #sed -i 's|#!.*python|#!/usr/bin/python|' $pkgdir/usr/bin/*
  
  for fname in "$pkgdir"/usr/bin/*; do mv "$fname" "$fname"3; done;
}

package_cython2-git() {
  depends=('python2')
  provides=('cython2')
  conflicts=('cython2')
  
  cd "$srcdir/$_gitname-build"
  python2 setup.py install --root="$pkgdir/" --optimize=1
  #sed -i 's|#!.*python|#!/usr/bin/python|' $pkgdir/usr/bin/*
  
  for fname in "$pkgdir"/usr/bin/*; do mv "$fname" "$fname"2; done;
}

# vim:set ts=2 sw=2 et:

